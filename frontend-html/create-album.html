<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Album - IUT Yearbook</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/album-upload.js" defer></script>
    <style>
        .upload-area {
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-lg);
            padding: 3rem;
            text-align: center;
            background-color: var(--color-bg);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 2rem;
        }

        .upload-area:hover,
        .upload-area.drag-over {
            border-color: var(--color-primary);
            background-color: #eef2ff;
        }

        .photo-preview-card {
            display: flex;
            gap: 1rem;
            background: white;
            padding: 1rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
            margin-bottom: 1rem;
            align-items: flex-start;
        }

        .preview-image {
            width: 120px;
            height: 120px;
            background-size: cover;
            background-position: center;
            border-radius: var(--radius-sm);
            flex-shrink: 0;
        }

        .preview-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .remove-btn {
            background: none;
            color: var(--color-error);
            width: fit-content;
            padding: 0;
            font-size: 0.875rem;
            text-decoration: underline;
        }

        .word-count {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            text-align: right;
        }
    </style>
    <script src="js/album-manager.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('form');
            form.addEventListener('submit', (e) => {
                e.preventDefault();

                const title = form.querySelector('input[type="text"]').value;
                const desc = form.querySelector('textarea').value;
                // Collect photo metadata
                const photoCards = document.querySelectorAll('.photo-preview-card');
                const photos = [];

                photoCards.forEach(card => {
                    const name = card.querySelector('.file-name').innerText;
                    const description = card.querySelector('textarea').value;
                    // Mock date for improved visualization
                    const randomDays = Math.floor(Math.random() * 10);
                    const date = new Date();
                    date.setDate(date.getDate() - randomDays);

                    photos.push({
                        name: name,
                        description: description,
                        date: date.toISOString(),
                        color: window.AlbumManager.getRandomColor()
                    });
                });

                const newAlbum = window.AlbumManager.saveAlbum({
                    title: title,
                    description: desc,
                    photos: photos
                });

                alert('Album "' + title + '" created successfully!');
                window.location.href = 'album-detail.html?id=' + newAlbum.id;
            });
        });
    </script>
</head>

<body>
    <nav class="navbar">
        <div class="container nav-container">
            <a href="dashboard.html" class="nav-logo">IUT Yearbook</a>
            <div class="nav-links">
                <a href="dashboard.html">Dashboard</a>
                <a href="albums.html">Albums</a>
                <a href="index.html">Logout</a>
            </div>
        </div>
    </nav>

    <main class="container" style="padding-top: 2rem; max-width: 800px;">
        <h1 style="margin-bottom: 2rem;">Create Personal Album</h1>

        <form action="album-detail.html">
            <div class="form-group">
                <label class="form-label">Album Title</label>
                <input type="text" placeholder="e.g. Graduation Trip 2024" required>
            </div>

            <div class="form-group">
                <label class="form-label">Description <span class="text-muted">(Max 200 chars)</span></label>
                <textarea rows="3" maxlength="200" placeholder="Briefly describe what this album is about..."
                    style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-border); border-radius: 0.5rem;"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Access Control</label>
                <input type="text" value="Personal (Only you can edit)" disabled
                    style="background-color: var(--color-bg); color: var(--color-text-muted);">
            </div>

            <div class="form-group">
                <label class="form-label">Upload Photos</label>
                <div id="drop-zone" class="upload-area">
                    <p style="font-size: 1.25rem; margin-bottom: 0.5rem;">Drop files here or click to upload</p>
                    <p class="text-muted">Supported: JPEG, JPG, PNG</p>
                    <input type="file" id="file-input" multiple accept="image/jpeg, image/png, image/jpg"
                        style="display: none;">
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem;">Selected Photos <span id="photo-count" class="text-muted"
                        style="font-weight: 400; font-size: 1rem;">(0)</span></h3>
                <div id="preview-container">
                    <!-- Previews will appear here -->
                </div>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <a href="dashboard.html" class="btn" style="border: 1px solid var(--color-border);">Cancel</a>
                <button type="submit" class="btn btn-primary">Create Album</button>
            </div>
        </form>
    </main>
</body>

</html>